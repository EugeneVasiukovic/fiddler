import Meddler;
import System;
import System.Net.Sockets;
import System.Windows.Forms;

// Script generated by Fiddler2 export.
//
// You can set options for this script using the format:
//     ScriptOptions("StartURL" (where {$PORT} is autoreplaced by the Meddler port number), "Optional HTTPS Certificate Thumbprint", "Random # Seed")
public ScriptOptions("http://localhost:{$PORT}/get_method?name=Evgeniy&age=23")
class Handlers
{
	static function OnConnection(oSession: Session)
	{
	try {
		if (oSession.ReadRequest())
		{
			var oHeaders: ResponseHeaders = new ResponseHeaders();
			if (oSession.requestHeaders.Path == '/get_method?name=Evgeniy&age=23')
			{

				oHeaders.Version='HTTP/1.0';
				oHeaders.Status='200 OK';

				oHeaders.Add('Content-Type', 'application/json');
				oHeaders.Add('Content-Length', '26');
				oHeaders.Add('Server', 'Werkzeug/2.0.1 Python/3.8.10');
				oHeaders.Add('Date', 'Sun, 28 May 2023 09:48:16 GMT');
				oHeaders.Add('Connection', 'close');
				oSession.WriteString(oHeaders);

				oSession.WriteBytes(Convert.FromBase64String('Ww0KICAiVm92YSIsIA0KICAiMTIiDQpdDQo='));
				oSession.CloseSocket(); return;
			}

			if (oSession.requestHeaders.Path == '/user_info_3')
			{

				oHeaders.Version='HTTP/1.0';
				oHeaders.Status='500 INTERNAL SERVER ERROR';

				oHeaders.Add('Content-Type', 'text/html; charset=utf-8');
				oHeaders.Add('X-XSS-Protection', '0');
				oHeaders.Add('Server', 'Werkzeug/2.0.1 Python/3.8.10');
				oHeaders.Add('Date', 'Sun, 28 May 2023 09:54:59 GMT');
				oHeaders.Add('Connection', 'close');
				oHeaders.Add('Content-Length', '393');
				oSession.WriteString(oHeaders);

				oSession.WriteBytes(Convert.FromBase64String('SFRUUC8xLjAgNTAwIA0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uDQpDb250ZW50LUxlbmd0aDogMjQzDQpTZXJ2ZXI6IFdlcmt6ZXVnLzIuMC4xIFB5dGhvbi8zLjguMTANCkRhdGU6IFN1biwgMjggTWF5IDIwMjMgMDk6NDk6NTkgR01UDQpDb25uZWN0aW9uOiBjbG9zZQ0KDQp7DQogICJhZ2UiOiAiMjgiLCANCiAgImZhbWlseSI6IHsNCiAgICAibmVpZ2hib3JzIjogWw0KICAgICAgWw0KICAgICAgICAiQWxleCIsIA0KICAgICAgICAyNA0KICAgICAgXSwgDQogICAgICBbDQogICAgICAgICJLYXRlIiwgDQogICAgICAgIDEyDQogICAgICBdDQogICAgXSwgDQogICAgInVfc2FsYXJ5XzFfNV95ZWFyIjogNDAwMDANCiAgfSwgDQogICJuYW1lIjogIkV2Z2VuaXkiLCANCg0KfQ0K'));
				oSession.CloseSocket(); return;
			}

			if (oSession.requestHeaders.Path == '/object_info_1?name=Evgeniy&age=28&weight=80')
			{

				oHeaders.Version='HTTP/1.0';
				oHeaders.Status='200 OK';

				oHeaders.Add('Content-Type', 'application/json');
				oHeaders.Add('Content-Length', '76');
				oHeaders.Add('Server', 'Werkzeug/2.0.1 Python/3.8.10');
				oHeaders.Add('Date', 'Sun, 28 May 2023 10:07:30 GMT');
				oHeaders.Add('Connection', 'close');
				oSession.WriteString(oHeaders);

				oSession.WriteBytes(Convert.FromBase64String('ew0KICAiYWdlIjogMTIsIA0KICAiZGFpbHlfZm9vZCI6IDEsIA0KICAic2xlZXAiOiAxLCANCiAgIm5hbWUiOiAiVm92YSINCn0NCg=='));
				oSession.CloseSocket(); return;
			}

			if (oSession.requestHeaders.Path == '/object_info_3?name=Evgeniy&age=28&salary=1000')
			{

				oHeaders.Version='HTTP/1.0';
				oHeaders.Status='200 OK';

				oHeaders.Add('Content-Type', 'application/json');
				oHeaders.Add('Content-Length', '380');
				oHeaders.Add('Server', 'Werkzeug/2.0.1 Python/3.8.10');
				oHeaders.Add('Date', 'Sun, 28 May 2023 10:12:23 GMT');
				oHeaders.Add('Connection', 'close');
				oSession.WriteString(oHeaders);

				oSession.WriteBytes(Convert.FromBase64String('ewogICJhZ2UiOiAiMjgiLCAKICAiZmFtaWx5IjogewogICAgImNoaWxkcmVuIjogWwogICAgICBbCiAgICAgICAgIkFsZXgiLCAKICAgICAgICAyNAogICAgICBdLCAKICAgICAgWwogICAgICAgICJLYXRlIiwgCiAgICAgICAgMTIKICAgICAgXQogICAgXSwgCiAgICAicGV0cyI6IHsKICAgICAgImNhdCI6IHsKICAgICAgICAiYWdlIjogMywgCiAgICAgICAgIm5hbWUiOiAiU3VubnkiCiAgICAgIH0sIAogICAgICAiZG9nIjogewogICAgICAgICJhZ2UiOiA0LCAKICAgICAgICAibmFtZSI6ICJMdWt5IgogICAgICB9CiAgICB9LCAKICAgICJ1X3NhbGFyeV8xXzVfeWVhciI6IDQwMDAKICB9LCAKICAibmFtZSI6ICJFdmdlbml5IiwgCiAgInNhbGFyeSI6IDEwMDAKfQo='));
				oSession.CloseSocket(); return;
			}

			if (oSession.requestHeaders.Path == '/object_info_3?name=Evgeniy&age=28&salary=1000')
			{

				oHeaders.Version='HTTP/1.0';
				oHeaders.Status='405';

				oHeaders.Add('Content-Type', 'application/json');
				oHeaders.Add('Content-Length', '391');
				oHeaders.Add('Server', 'Werkzeug/2.0.1 Python/3.8.10');
				oHeaders.Add('Date', 'Sun, 28 May 2023 10:12:23 GMT');
				oHeaders.Add('Connection', 'close');
				oSession.WriteString(oHeaders);

				oSession.WriteBytes(Convert.FromBase64String('ew0KICAiYWdlIjogIjEyIiwgDQogICJmYW1pbHkiOiB7DQogICAgImNoaWxkcmVuIjogWw0KICAgICAgWw0KICAgICAgICAiQWxleCIsIA0KICAgICAgICAyNA0KICAgICAgXSwgDQogICAgICBbDQogICAgICAgICJLYXRlIiwgDQogICAgICAgIDEyDQogICAgICBdDQogICAgXSwgDQogICAgInBldHMiOiB7DQogICAgICAiY2F0Ijogew0KICAgICAgICAiYWdlIjogMywgDQogICAgICAgICJuYW1lIjogIk9za2FyIg0KICAgICAgfSwgDQogICAgICAiZG9nIjogew0KICAgICAgICAiYWdlIjogNCwgDQogICAgICAgICJuYW1lIjogIkx1a3kiDQogICAgICB9DQogICAgfSwgDQogICAgInVfc2FsYXJ5XzFfNV95ZWFyIjogNDAwMA0KICB9LCANCiAgIm5hbWUiOiAiVm92YSIsIA0KICANCn0NCg=='));
				oSession.CloseSocket(); return;
			}

			if (oSession.requestHeaders.Path == '/object_info_4?name=Evgeniy&age=28&salary=1000')
			{

				oHeaders.Version='HTTP/1.0';
				oHeaders.Status='405';

				oHeaders.Add('Content-Type', 'application/json');
				oHeaders.Add('Content-Length', '43');
				oHeaders.Add('Server', 'Werkzeug/2.0.1 Python/3.8.10');
				oHeaders.Add('Date', 'Sun, 28 May 2023 10:15:44 GMT');
				oHeaders.Add('Connection', 'close');
				oSession.WriteString(oHeaders);

				oSession.WriteBytes(Convert.FromBase64String('ew0KICAiYWdlIjogMTIsIA0KICAibmFtZSI6ICJ2b3ZhIiwgDQoNCn0NCg=='));
				oSession.CloseSocket(); return;
			}

			if (oSession.requestHeaders.Path == '/user_info_2')
			{

				oHeaders.Version='HTTP/1.0';
				oHeaders.Status='200 OK';

				oHeaders.Add('Content-Type', 'application/XML');
				oHeaders.Add('Content-Length', '199');
				oHeaders.Add('Server', 'Werkzeug/2.0.1 Python/3.8.10');
				oHeaders.Add('Date', 'Sun, 28 May 2023 10:18:28 GMT');
				oHeaders.Add('Connection', 'close');
				oHeaders.Add('XML', 'text/xml, application/XML');
				oSession.WriteString(oHeaders);

				oSession.WriteBytes(Convert.FromBase64String('ew0KICANCiAgInFhX3NhbGFyeV9hZnRlcl8xLjVfeWVhciI6IDMzMDAwLjAsIA0KICAicWFfc2FsYXJ5X2FmdGVyXzEyX21vbnRocyI6IDI3MDAuMCwgDQogICJxYV9zYWxhcnlfYWZ0ZXJfMy41X3llYXJzIjogMzgwMC4wLCANCiAgInFhX3NhbGFyeV9hZnRlcl8xMF9tb250aHMiOiAyMDAwLCANCiAgInN0YXJ0X3FhX3NhbGFyeSI6IDEwMDANCn0NCg=='));
				oSession.CloseSocket(); return;
			}
		}
		oSession.CloseSocket();
		}
		catch(e) {MeddlerObject.Log.LogString("Script threw exception\n"+e);}
	}
}